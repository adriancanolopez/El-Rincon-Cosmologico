---
export const prerender = false;
import { getNewsBySlug } from "../../api/NewsRequests";
import Layout from "../../layouts/Layout.astro";
import '../../styles/news.css';
import formatDateToString from "../../utils/formatDateToString";

const { slug } = Astro.params;

if (!slug) {
    return Astro.redirect('/noticias');
}

const newsRequest = await getNewsBySlug(slug);

let news;

if (newsRequest.ok) {
    news = newsRequest.data;
}
else {
    console.log(newsRequest.message);
    return Astro.redirect('/noticias');
}

---

<Layout title={`Noticia - ${news.title}`}>
    <section class="flex flex-col mt-4">
        <a href="/noticias/" class="w-20 text-center bg-blue-600 rounded-md ml-2 mb-2 p-2 transition-colors hover:bg-blue-700">
            <button class="hover:cursor-pointer">Volver</button>
        </a>
        <article class="w-full max-w-3xl bg-gray-900 text-slate-100 mx-auto rounded-xl shadow-[0_0_40px_-15px_rgba(255,255,255,0.3)] news-article">
            {
                news.imageUrl && (
                    <img src={`http://localhost:3000/uploads/news/${news.imageUrl}`} alt={`Imagen de la noticia: ${news.title}`} class="w-full max-h-[350px] object-cover rounded-t-xl"/>
                )
            }
            <div class="flex flex-col gap-8 px-6 md:px-12 py-10">
                <header class="flex flex-col gap-4">
                    <div class="flex gap-4 text-sm text-center border-b border-slate-700 pb-6">
                        <time datetime={news.createdAt}>
                            <span class="font-semibold text-slate-200">Publicado: </span> {formatDateToString(news.createdAt as string)}
                        </time>
                        {
                            news.updatedAt !== news.createdAt && (
                                <time datetime={news.updatedAt} class="italic text-slate-500">
                                    Actualizado: {formatDateToString(news.createdAt as string)}
                                </time>
                            )
                        }
                    </div>
                    <h1 class="text-3xl md:text-4xl xl:text-5xl font-extrabold leading-tight text-center">{news.title}</h1>
                </header>
                <div class="description text-slate-200 leading-relaxed">
                    <p set:html={news.description}></p>
                </div>
            </div>
        </article>
    </section>
</Layout>
---
import Layout from "../../layouts/Layout.astro";
import '../../styles/forms.css';
---

<Layout title="Iniciar sesi칩n">
    <section class="flex flex-col items-center">
        <h1 id="form-title">Iniciar sesi칩n</h1>
        <form action="" method="POST" class="form" id="loginForm">
            <div class="form-field">
                <label for="email">Email:</label>
                <input type="email" name="email" id="email" required>
            </div>
            <div class="form-field">
                <label for="password">Contrase침a:</label>
                <input type="password" name="password" id="password" required>
            </div>
            <div class="form-field items-center">
                <input type="submit" value="Iniciar Sesi칩n" id="submit">
                <span id="error-message"></span>
            </div>
        </form>
    </section>
</Layout>

<script>
    import { login } from "../../api/UsersRequests";

    const form = document.querySelector("#loginForm") as HTMLFormElement;

    form?.addEventListener('submit', async function(event: Event) {
        event.preventDefault();
        
        const email = document.querySelector("#email") as HTMLInputElement;
        const password = document.querySelector("#password") as HTMLInputElement;
        const messageElement = document.querySelector('#error-message') as HTMLSpanElement;

        const response = await login({email: email.value, password: password.value});

        if (response.ok) {
            window.location.href = '/admin/news';
        }
        else {
            messageElement.classList.add('error-message');
            messageElement.innerHTML = response.message;
        }
    });
</script>